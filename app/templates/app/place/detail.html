{% extends 'app/base.html' %}
{% load app_tags static %}
{% block title %}
    {% if place.title %}
        {{ place.title }}
    {% else %}
        {{ place.name }}
    {% endif %}
{% endblock %}

{% block style %}
    <style>
        .iframe_wrap iframe {
            box-shadow: 0 1px 2px 0 rgb(60 64 67 / 30%), 0 1px 3px 1px rgb(60 64 67 / 15%);
            border-radius: 5px;
            display: block;
            margin: auto;
        }

        .base_rating_area {
            display: block;
            margin: 10px auto;
            width: fit-content;
        }

        #base_rating {
            font-size: 27px;
            color: gold;
            font-weight: 600;
        }
    </style>
{% endblock %}

{% block meta %}
    {% if place.meta %}
        {{ place.meta|safe }}
    {% endif %}
{% endblock %}

{% block breadcrumb %}
    <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="{% url 'app:query_list' %}">Мои запросы</a></li>
            {#    <li class="breadcrumb-item"><a href="{{ place.query.get_absolute_url }}">{{ place.query.name }}</a></li>#}
            <li class="is-active"><a href="#" aria-current="page">{{ place.cid }}</a></li>
        </ul>
    </nav>

{% endblock %}

{% block content %}
    <div class="modal" id="modal" onclick="closeModal()">
        <div class="modal-background"></div>
        <div class="modal-content">
            <p class="image is-4by3">
                <img src="" alt="" id="place_image" style="border-radius: 5px">
            </p>
        </div>
        <button class="modal-close is-large" aria-label="close" onclick="closeModal()"></button>
    </div>
    {#    <div class="box block_data show" id="basic_data">#}
    {#        <span>{{ place.date_create }}</span>#}
    {#        <div class="">#}
    {#            <p><span>Название:</span> <span>{{ place.data.name }}</span></p>#}
    {#            <p><span>Адрес:</span> <span>{{ place.data.formatted_address }}</span></p>#}
    {#            <p><span>Рейтинг:</span> <span>{{ place.data.rating }}</span></p>#}
    {#            <p><span>Пользователей оценило:</span> <span>{{ place.data.user_ratings_total }}</span></p>#}
    {#            <p><span>Тип:</span> <span>{% for type in place.data.types %}{{ type }}{% if not forloop.last %},#}
    {#            {% endif %}{% endfor %}</span></p>#}
    {##}
    {#        </div>#}
    {#    </div>#}
    {% include 'app/include/place/card.html' with place=place %}
    <div class="dropdown" onclick="this.classList.toggle('is-active')">
        <div class="dropdown-trigger">
            <button class="button" aria-haspopup="true" aria-controls="dropdown-menu3">
                <span>Относящийся запросы</span>
                <span class="icon is-small">
                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                  </span>
            </button>
        </div>
        <div class="dropdown-menu" id="dropdown-menu3" role="menu">
            <div class="dropdown-content">
                {% for query in place.queries.all %}
                    <a href="{% url 'app:places' query.query.slug %}" class="dropdown-item">
                        {{ query }}
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>
    <hr>
    <h3 class="block_title">Отзывы</h3>
    <div class="columns is-centered">
        <div class="review_form box column is-8">
            {% if not my_review %}
                {% include 'app/include/review/form.html' %}
            {% else %}
                <p class="text_centered" style="color:lightgreen;">Ваш отзыв сохранен</p>
            {% endif %}
        </div>
    </div>
    <br>
    <div class="columns is-centered">
        <div class="column is-9 ">
            {% for review in reviews %}
                {% include 'app/include/review/card.html' with review=review %}
            {% endfor %}


            {% include 'app/include/pagination.html' with page=reviews %}
        </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        function showImg(){
            let modal = document.getElementById('modal');
            modal.classList.toggle('is-active');
        }

        function showModalImg(url) {
            let img = document.getElementById('place_image');
            img.setAttribute('src', url);
            showImg();
        }

        function closeModal() {
            let modal = document.getElementById('modal');
            modal.classList.toggle('is-active');
        }
    </script>
    <script src="{% static 'js/rating_check.js' %}"></script>
    {#    <script>#}
    {#        function toggleActive(elem) {#}
    {#            if (!elem.classList.contains('is-active')) {#}
    {#                let tab_elements = document.querySelectorAll('li.tab');#}
    {#                tab_elements.forEach((element) => {#}
    {#                    let data_box_id = element.getAttribute('data-box');#}
    {#                    let data_box = document.getElementById(data_box_id);#}
    {#                    data_box.classList.toggle('show');#}
    {#                    element.classList.toggle('is-active')#}
    {#                })#}
    {#            }#}
    {#        }#}
    {#    </script>#}
{% endblock %}