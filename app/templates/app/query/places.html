{% extends 'app/base.html' %}
{% load app_tags static %}

{% block title %}
    {{ query.name }}
{% endblock %}


{% block style %}
{% endblock %}


{% block breadcrumb %}
    <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="{% url 'app:index' %}">Главная</a></li>
            <li><a href="{% url 'app:queries' %}">Места</a></li>
            <li class="is-active"><a href="">{{ query.name }}</a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    <div class="modal" id="modal">
        <div class="modal-background" onclick="closeModal()"></div>
        <div class="modal-content" id="modal_content">

        </div>
        <button class="modal-close is-large" onclick="closeModal()" aria-label="close"></button>
    </div>

    <h4 class="block_title"> {{ query.name }}
        <div style="right: 15px;position: absolute;color: #878787;margin-top: -20px;">
            <a href="{% url 'app:places_copy' query.slug %}"><i class="fa fa-link"></i></a>
            <span><i class="fa fa-copy query_clone_icon" data-query-slug="{{ query.slug }}"></i></span>
        </div>
    </h4>

    <hr>
    <div class="columns is-centered">
        <div class="column is-9">
            <h4 style="text-align: center">Описание</h4>
            {% if request.user|hasGroup:'Администратор' %}
                <a href="{% url 'app:query_edit' query.slug %}" class="button is-success is-light is-outlined centered"
                   style="width: fit-content"><i class="fa fa-edit"></i></a>
            {% endif %}
            <div>
                {{ query.content|isValue:'<span style="color: grey; margin: 10px auto; display: block; width: fit-content;">Описание не найдено</span>'|safe }}
            </div>
            <br>
            <div style="display:flex; justify-content: center">
                {% for tag in query.tags.all %}
                    <span class="tag is-medium is-info" style="margin: 3px;">{{ tag.name }}</span>
                {% endfor %}
            </div>
        </div>
    </div>
    {% if request.user.is_authenticated %}
        <a href="{% url 'app:query_rating_edit' query.slug %}" class="button is-outlined is-large"
           style="margin: 10px auto; display: block; width: fit-content ">Редактировать рейтинг</a>
    {% endif %}
    <div class="columns is-centered is-multiline">
        {% for place in top_places %}
            {% include 'app/include/place/preview_card.html' with place=place %}
        {% endfor %}
    </div>
    <hr>

    <h4 class="block_title">Весь список</h4>
    <div class="columns is-multiline">
        {% for letter in letters %}
            <div class="column is-3">
                <hr>
                <span style="color: cornflowerblue">{{ letter }}</span>
                {% for place in places_letter|getValue:letter|getValue:'places' %}
                    <p><a href="{{ place.get_absolute_url }}" class="hover_link">{{ place.name }}</a></p>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
    <hr>
    <div style="color: grey">
        <p>Всего {{ places.count }} объектов</p>
    </div>
{% endblock %}


{% block script %}
    <script src="{% static 'js/copy_place.js' %}"></script>
{% endblock %}